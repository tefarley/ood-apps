{
  "version": 3,
  "sources": ["../../javascript/packs/support_ticket.js"],
  "sourcesContent": ["'use strict';\n\njQuery(function (){\n    let attachmentIdCounter = 0;\n\n    function createId() {\n        return `attachment_id_${++attachmentIdCounter}`;\n    }\n\n    function fileSizeToString(number) {\n        if(number < 1024) {\n            return number + \"bytes\";\n        } else if(number >= 1024 && number < 1048576) {\n            return (number/1024).toFixed(1) + \"KB\";\n        } else if(number >= 1048576) {\n            return (number/1048576).toFixed(1) + \"MB\";\n        }\n    }\n\n    function validateForm(event) {\n        const validForm = $(\"#new_support_ticket\")[0].reportValidity();\n        if(!validForm) {\n            event.preventDefault();\n            return;\n        }\n\n        //SHOW FULL PAGE SPINNER\n        $(\"body\").addClass(\"modal-open\");\n        $(\"#full-page-spinner\").removeClass('d-none');\n    }\n\n    function clearAttachmentsError() {\n        const $errorElement = $(\"#attachments_error\");\n        $errorElement.parent().removeClass(\"has-error\");\n        $errorElement.remove();\n    }\n\n    function showAttachmentsError(message) {\n        const $attachmentsElement = $(\"[data-toggle='attachments-error']\");\n        $attachmentsElement.parent().addClass(\"has-error\");\n        $attachmentsElement.after(`<div class=\"help-block\" id=\"attachments_error\">${message}</div>`);\n    }\n\n    function deleteAttachment(event) {\n        clearAttachmentsError();\n        const attachmentContainerId = event.currentTarget.getAttribute(\"data-attachment-container\");\n        $(`#${attachmentContainerId}`).remove();\n    }\n\n    function updateAttachmentContent(event) {\n        clearAttachmentsError();\n        const $fileElement = $(event.currentTarget);\n        const files = $fileElement.prop('files');\n        if (!files || files.length === 0) {\n            return;\n        }\n\n        const fileInfo = files[0];\n        if(fileInfo.size > SUPPORT_TICKET_RESTRICTIONS.max_size) {\n            createAttachmentElement((newAttachment) => {\n                $fileElement.parent().replaceWith(newAttachment);\n            });\n            const message = SUPPORT_TICKET_MESSAGES[\"size.attachments\"].replace(\"%{max}\", fileSizeToString(SUPPORT_TICKET_RESTRICTIONS.max_size)).replace(\"%{size}\", fileSizeToString(fileInfo.size));\n            showAttachmentsError(message);\n            return;\n        }\n\n        const fileInputId = event.currentTarget.id;\n        $(`label[for='${fileInputId}']`).text(`Selected file: ${fileInfo.name} (${fileSizeToString(fileInfo.size)}).`);\n    }\n\n    function createAttachmentElement(attachmentPlacementCallback) {\n        const newAttachmentContainerId = createId();\n        const newFileInputId = createId();\n        const newAttachment =\n        `<div class=\"attachment-input\" id=\"${newAttachmentContainerId}\">\n           <div class=\"form-control attachment-input-content\">\n              <label class=\"attachment-file-label\" for=\"${newFileInputId}\">No file selected</label>\n              <span class=\"attachment-delete\" data-toggle=\"attachment-delete\" data-attachment-container=\"${newAttachmentContainerId}\" title=\"Delete attachment\"><i class=\"fas fa-trash-alt\"></i></span>\n           </div>\n           <input class=\"form-control\"  type=\"file\" name=\"support_ticket[attachments][]\" id=\"${newFileInputId}\">\n        </div>`;\n\n        attachmentPlacementCallback(newAttachment);\n        $(\"input[type='file']\").on(\"change\", updateAttachmentContent);\n        $(\"[data-toggle='attachment-delete']\").on(\"click\", deleteAttachment);\n        return newAttachment;\n    }\n\n    function addAttachment() {\n        clearAttachmentsError();\n        if($(\"input[type='file']\").length >= SUPPORT_TICKET_RESTRICTIONS.max_items ) {\n            showAttachmentsError(SUPPORT_TICKET_MESSAGES[\"items.attachments\"]);\n            return;\n        }\n\n        createAttachmentElement((newAttachment) => {\n            $(\"#attachments-container\").append(newAttachment);\n        });\n    }\n\n    $(function() {\n        $(\"[data-toggle='attachments-add']\").on(\"click\", addAttachment);\n        $(\"#new_support_ticket\").submit(validateForm);\n    });\n\n});"],
  "mappings": "AAEA,OAAO,UAAW,CACd,IAAIA,EAAsB,EAE1B,SAASC,GAAW,CAChB,MAAO,iBAAiB,EAAED,GAC9B,CAEA,SAASE,EAAiBC,EAAQ,CAC9B,GAAGA,EAAS,KACR,OAAOA,EAAS,QACb,GAAGA,GAAU,MAAQA,EAAS,QACjC,OAAQA,EAAO,MAAM,QAAQ,CAAC,EAAI,KAC/B,GAAGA,GAAU,QAChB,OAAQA,EAAO,SAAS,QAAQ,CAAC,EAAI,IAE7C,CAEA,SAASC,EAAaC,EAAO,CAEzB,GAAG,CADe,EAAE,qBAAqB,EAAE,GAAG,eAAe,EAC9C,CACXA,EAAM,eAAe,EACrB,MACJ,CAGA,EAAE,MAAM,EAAE,SAAS,YAAY,EAC/B,EAAE,oBAAoB,EAAE,YAAY,QAAQ,CAChD,CAEA,SAASC,GAAwB,CAC7B,IAAMC,EAAgB,EAAE,oBAAoB,EAC5CA,EAAc,OAAO,EAAE,YAAY,WAAW,EAC9CA,EAAc,OAAO,CACzB,CAEA,SAASC,EAAqBC,EAAS,CACnC,IAAMC,EAAsB,EAAE,mCAAmC,EACjEA,EAAoB,OAAO,EAAE,SAAS,WAAW,EACjDA,EAAoB,MAAM,kDAAkDD,SAAe,CAC/F,CAEA,SAASE,EAAiBN,EAAO,CAC7BC,EAAsB,EACtB,IAAMM,EAAwBP,EAAM,cAAc,aAAa,2BAA2B,EAC1F,EAAE,IAAIO,GAAuB,EAAE,OAAO,CAC1C,CAEA,SAASC,EAAwBR,EAAO,CACpCC,EAAsB,EACtB,IAAMQ,EAAe,EAAET,EAAM,aAAa,EACpCU,EAAQD,EAAa,KAAK,OAAO,EACvC,GAAI,CAACC,GAASA,EAAM,SAAW,EAC3B,OAGJ,IAAMC,EAAWD,EAAM,GACvB,GAAGC,EAAS,KAAO,4BAA4B,SAAU,CACrDC,EAAyBC,GAAkB,CACvCJ,EAAa,OAAO,EAAE,YAAYI,CAAa,CACnD,CAAC,EACD,IAAMT,EAAU,wBAAwB,oBAAoB,QAAQ,SAAUP,EAAiB,4BAA4B,QAAQ,CAAC,EAAE,QAAQ,UAAWA,EAAiBc,EAAS,IAAI,CAAC,EACxLR,EAAqBC,CAAO,EAC5B,MACJ,CAEA,IAAMU,EAAcd,EAAM,cAAc,GACxC,EAAE,cAAcc,KAAe,EAAE,KAAK,kBAAkBH,EAAS,SAASd,EAAiBc,EAAS,IAAI,KAAK,CACjH,CAEA,SAASC,EAAwBG,EAA6B,CAC1D,IAAMC,EAA2BpB,EAAS,EACpCqB,EAAiBrB,EAAS,EAC1BiB,EACN,qCAAqCG;AAAA;AAAA,0DAEaC;AAAA,2GACiDD;AAAA;AAAA,+FAEZC;AAAA,gBAGvF,OAAAF,EAA4BF,CAAa,EACzC,EAAE,oBAAoB,EAAE,GAAG,SAAUL,CAAuB,EAC5D,EAAE,mCAAmC,EAAE,GAAG,QAASF,CAAgB,EAC5DO,CACX,CAEA,SAASK,GAAgB,CAErB,GADAjB,EAAsB,EACnB,EAAE,oBAAoB,EAAE,QAAU,4BAA4B,UAAY,CACzEE,EAAqB,wBAAwB,oBAAoB,EACjE,MACJ,CAEAS,EAAyBC,GAAkB,CACvC,EAAE,wBAAwB,EAAE,OAAOA,CAAa,CACpD,CAAC,CACL,CAEA,EAAE,UAAW,CACT,EAAE,iCAAiC,EAAE,GAAG,QAASK,CAAa,EAC9D,EAAE,qBAAqB,EAAE,OAAOnB,CAAY,CAChD,CAAC,CAEL,CAAC",
  "names": ["attachmentIdCounter", "createId", "fileSizeToString", "number", "validateForm", "event", "clearAttachmentsError", "$errorElement", "showAttachmentsError", "message", "$attachmentsElement", "deleteAttachment", "attachmentContainerId", "updateAttachmentContent", "$fileElement", "files", "fileInfo", "createAttachmentElement", "newAttachment", "fileInputId", "attachmentPlacementCallback", "newAttachmentContainerId", "newFileInputId", "addAttachment"]
}
