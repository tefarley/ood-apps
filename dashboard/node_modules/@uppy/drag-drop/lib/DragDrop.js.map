{"version":3,"sources":["DragDrop.jsx"],"names":["toArray","isDragDropSupported","getDroppedFiles","packageJson","locale","DragDrop","UIPlugin","constructor","uppy","opts","handleDrop","event","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","setPluginState","isDraggingOver","logDropError","error","log","files","dataTransfer","length","addFiles","onDrop","type","id","title","defaultLocale","defaultOpts","target","inputName","width","height","note","i18nInit","onInputChange","bind","handleDragOver","handleDragLeave","render","descriptors","map","file","source","name","data","meta","relativePath","err","value","types","hasFiles","some","allowNewUpload","getState","dropEffect","onDragOver","setTimeout","onDragLeave","renderHiddenFileInput","restrictions","ref","fileInputRef","maxNumberOfFiles","allowedFileTypes","renderArrowSvg","renderLabel","i18nArray","browse","i18n","renderNote","dragDropClass","getPluginState","dragDropStyle","click","install","mount","uninstall","unmount","VERSION","version"],"mappings":"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","sourcesContent":["import { UIPlugin } from '@uppy/core'\nimport toArray from '@uppy/utils/lib/toArray'\nimport isDragDropSupported from '@uppy/utils/lib/isDragDropSupported'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport { h } from 'preact'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\n/**\n * Drag & Drop plugin\n *\n */\nexport default class DragDrop extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = locale\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n      inputName: 'files[]',\n      width: '100%',\n      height: '100%',\n      note: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n\n    this.i18nInit()\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = isDragDropSupported()\n    this.removeDragOverClassTimeout = null\n\n    // Bind `this` to class methods\n    this.onInputChange = this.onInputChange.bind(this)\n    this.handleDragOver = this.handleDragOver.bind(this)\n    this.handleDragLeave = this.handleDragLeave.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n    this.addFiles = this.addFiles.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  addFiles (files) {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  onInputChange (event) {\n    const files = toArray(event.target.files)\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files selected through input')\n      this.addFiles(files)\n    }\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    // eslint-disable-next-line no-param-reassign\n    event.target.value = null\n  }\n\n  handleDragOver (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Check if the \"type\" of the datatransfer object includes files. If not, deny drop.\n    const { types } = event.dataTransfer\n    const hasFiles = types.some(type => type === 'Files')\n    const { allowNewUpload } = this.uppy.getState()\n    if (!hasFiles || !allowNewUpload) {\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.dropEffect = 'none'\n      clearTimeout(this.removeDragOverClassTimeout)\n      return\n    }\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser\n    // https://github.com/transloadit/uppy/issues/1978)\n    //\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n\n    this.opts.onDragOver?.(event)\n  }\n\n  handleDragLeave (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n\n    this.opts.onDragLeave?.(event)\n  }\n\n  handleDrop = async (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n\n    // Add all dropped files\n    const files = await getDroppedFiles(event.dataTransfer, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  renderHiddenFileInput () {\n    const { restrictions } = this.uppy.opts\n    return (\n      <input\n        className=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => { this.fileInputRef = ref }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        accept={restrictions.allowedFileTypes}\n        onChange={this.onInputChange}\n      />\n    )\n  }\n\n  static renderArrowSvg () {\n    return (\n      <svg aria-hidden=\"true\" focusable=\"false\" className=\"uppy-c-icon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fillRule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  renderLabel () {\n    return (\n      <div className=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: <span className=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>,\n        })}\n      </div>\n    )\n  }\n\n  renderNote () {\n    return (\n      <span className=\"uppy-DragDrop-note\">{this.opts.note}</span>\n    )\n  }\n\n  render () {\n    const dragDropClass = `uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height,\n    }\n\n    return (\n      <button\n        type=\"button\"\n        className={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div className=\"uppy-DragDrop-inner\">\n          {DragDrop.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install () {\n    const { target } = this.opts\n\n    this.setPluginState({\n      isDraggingOver: false,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}