{"version":3,"sources":["ProviderView.jsx"],"names":["AuthView","Header","Browser","LoaderView","CloseWrapper","View","packageJson","getOrigin","location","origin","getRegex","value","RegExp","undefined","isOriginAllowed","allowedOrigin","patterns","Array","isArray","map","some","pattern","test","ProviderView","constructor","plugin","opts","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","filterQuery","bind","getFolder","getNextFolder","logout","handleAuth","handleScroll","listAllFiles","donePicking","render","setPluginState","authenticated","files","folders","directories","filterInput","isSearchVisible","currentSelection","tearDown","id","name","sharedHandler","loaderWrapper","provider","list","res","updatedDirectories","state","getPluginState","index","findIndex","dir","slice","concat","title","username","handleError","folder","requestPath","lastCheckbox","then","ok","revoked","message","uppy","i18n","url","manual_revoke_url","info","newState","catch","e","target","addFolder","folderId","providerFileToId","selectedFolders","loading","count","forEach","file","checkIfFileAlreadyExists","addFile","ids","length","smart_count","ensurePreAuth","authState","btoa","JSON","stringify","clientVersion","VERSION","link","authUrl","uppyVersions","authWindow","window","open","handleToken","source","log","companionAllowedHosts","data","parse","error","token","close","removeEventListener","setAuthToken","preFirstRender","addEventListener","event","path","nextPagePath","shouldHandleScroll","isHandlingScroll","response","items","item","isFolder","push","moreFiles","promises","Promise","all","clearSelection","viewOptions","didFirstRender","targetViewOptions","isChecked","toggleCheckbox","recordShiftKeyPress","filterItems","hasInput","headerProps","pluginIcon","icon","browserProps","done","cancel","cancelPicking","headerComponent","uppyFiles","getFiles","validateRestrictions","i18nArray","version"],"mappings":"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","sourcesContent":["import { h } from 'preact'\n\nimport AuthView from './AuthView.jsx'\nimport Header from './Header.jsx'\nimport Browser from '../Browser.jsx'\nimport LoaderView from '../Loader.jsx'\nimport CloseWrapper from '../CloseWrapper.js'\nimport View from '../View.js'\n\nimport packageJson from '../../package.json'\n\nfunction getOrigin () {\n  // eslint-disable-next-line no-restricted-globals\n  return location.origin\n}\n\nfunction getRegex (value) {\n  if (typeof value === 'string') {\n    return new RegExp(`^${value}$`)\n  } if (value instanceof RegExp) {\n    return value\n  }\n  return undefined\n}\nfunction isOriginAllowed (origin, allowedOrigin) {\n  const patterns = Array.isArray(allowedOrigin) ? allowedOrigin.map(getRegex) : [getRegex(allowedOrigin)]\n  return patterns\n    .some((pattern) => pattern?.test(origin) || pattern?.test(`${origin}/`)) // allowing for trailing '/'\n}\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nexport default class ProviderView extends View {\n  static VERSION = packageJson.version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    super(plugin, opts)\n    // set default options\n    const defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.filterQuery = this.filterQuery.bind(this)\n    this.getFolder = this.getFolder.bind(this)\n    this.getNextFolder = this.getNextFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.listAllFiles = this.listAllFiles.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false,\n      currentSelection: [],\n    })\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  tearDown () {\n    // Nothing.\n  }\n\n  #updateFilesAndFolders (res, files, folders) {\n    this.nextPagePath = res.nextPagePath\n    res.items.forEach((item) => {\n      if (item.isFolder) {\n        folders.push(item)\n      } else {\n        files.push(item)\n      }\n    })\n\n    this.plugin.setPluginState({ folders, files })\n  }\n\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   *\n   * @param  {string} id Folder id\n   * @returns {Promise}   Folders/files in folder\n   */\n  getFolder (id, name) {\n    return this.sharedHandler.loaderWrapper(\n      this.provider.list(id),\n      (res) => {\n        const folders = []\n        const files = []\n        let updatedDirectories\n\n        const state = this.plugin.getPluginState()\n        const index = state.directories.findIndex((dir) => id === dir.id)\n\n        if (index !== -1) {\n          updatedDirectories = state.directories.slice(0, index + 1)\n        } else {\n          updatedDirectories = state.directories.concat([{ id, title: name }])\n        }\n\n        this.username = res.username || this.username\n        this.#updateFilesAndFolders(res, files, folders)\n        this.plugin.setPluginState({ directories: updatedDirectories })\n      },\n      this.handleError,\n    )\n  }\n\n  /**\n   * Fetches new folder\n   *\n   * @param  {object} folder\n   */\n  getNextFolder (folder) {\n    this.getFolder(folder.requestPath, folder.name)\n    this.lastCheckbox = undefined\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  logout () {\n    this.provider.logout()\n      .then((res) => {\n        if (res.ok) {\n          if (!res.revoked) {\n            const message = this.plugin.uppy.i18n('companionUnauthorizeHint', {\n              provider: this.plugin.title,\n              url: res.manual_revoke_url,\n            })\n            this.plugin.uppy.info(message, 'info', 7000)\n          }\n\n          const newState = {\n            authenticated: false,\n            files: [],\n            folders: [],\n            directories: [],\n          }\n          this.plugin.setPluginState(newState)\n        }\n      }).catch(this.handleError)\n  }\n\n  filterQuery (e) {\n    const state = this.plugin.getPluginState()\n    this.plugin.setPluginState({ ...state, filterInput: e ? e.target.value : '' })\n  }\n\n  /**\n   * Adds all files found inside of specified folder.\n   *\n   * Uses separated state while folder contents are being fetched and\n   * mantains list of selected folders, which are separated from files.\n   */\n  addFolder (folder) {\n    const folderId = this.providerFileToId(folder)\n    const folders = { ...this.plugin.getPluginState().selectedFolders }\n\n    if (folderId in folders && folders[folderId].loading) {\n      return\n    }\n\n    folders[folderId] = { loading: true, files: [] }\n\n    this.plugin.setPluginState({ selectedFolders: { ...folders } })\n\n    // eslint-disable-next-line consistent-return\n    return this.listAllFiles(folder.requestPath).then((files) => {\n      let count = 0\n\n      // If the same folder is added again, we don't want to send\n      // X amount of duplicate file notifications, we want to say\n      // the folder was already added. This checks if all files are duplicate,\n      // if that's the case, we don't add the files.\n      files.forEach(file => {\n        const id = this.providerFileToId(file)\n        if (!this.plugin.uppy.checkIfFileAlreadyExists(id)) {\n          count++\n        }\n      })\n\n      if (count > 0) {\n        files.forEach((file) => this.addFile(file))\n      }\n\n      const ids = files.map(this.providerFileToId)\n\n      folders[folderId] = {\n        loading: false,\n        files: ids,\n      }\n      this.plugin.setPluginState({ selectedFolders: folders })\n\n      let message\n\n      if (count === 0) {\n        message = this.plugin.uppy.i18n('folderAlreadyAdded', {\n          folder: folder.name,\n        })\n      } else if (files.length) {\n        message = this.plugin.uppy.i18n('folderAdded', {\n          smart_count: count, folder: folder.name,\n        })\n      } else {\n        message = this.plugin.uppy.i18n('emptyFolderAdded')\n      }\n\n      this.plugin.uppy.info(message)\n    }).catch((e) => {\n      const selectedFolders = { ...this.plugin.getPluginState().selectedFolders }\n      delete selectedFolders[folderId]\n      this.plugin.setPluginState({ selectedFolders })\n      this.handleError(e)\n    })\n  }\n\n  async handleAuth () {\n    await this.provider.ensurePreAuth()\n\n    const authState = btoa(JSON.stringify({ origin: getOrigin() }))\n    const clientVersion = `@uppy/provider-views=${ProviderView.VERSION}`\n    const link = this.provider.authUrl({ state: authState, uppyVersions: clientVersion })\n\n    const authWindow = window.open(link, '_blank')\n    const handleToken = (e) => {\n      if (e.source !== authWindow) {\n        this.plugin.uppy.log('rejecting event from unknown source')\n        return\n      }\n      if (!isOriginAllowed(e.origin, this.plugin.opts.companionAllowedHosts) || e.source !== authWindow) {\n        this.plugin.uppy.log(`rejecting event from ${e.origin} vs allowed pattern ${this.plugin.opts.companionAllowedHosts}`)\n      }\n\n      // Check if it's a string before doing the JSON.parse to maintain support\n      // for older Companion versions that used object references\n      const data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data\n\n      if (data.error) {\n        this.plugin.uppy.log('auth aborted', 'warning')\n        const { uppy } = this.plugin\n        const message = uppy.i18n('authAborted')\n        uppy.info({ message }, 'warning', 5000)\n        return\n      }\n\n      if (!data.token) {\n        this.plugin.uppy.log('did not receive token from auth window', 'error')\n        return\n      }\n\n      authWindow.close()\n      window.removeEventListener('message', handleToken)\n      this.provider.setAuthToken(data.token)\n      this.preFirstRender()\n    }\n    window.addEventListener('message', handleToken)\n  }\n\n  async handleScroll (event) {\n    const path = this.nextPagePath || null\n\n    if (this.shouldHandleScroll(event) && path) {\n      this.isHandlingScroll = true\n\n      try {\n        const response = await this.provider.list(path)\n        const { files, folders } = this.plugin.getPluginState()\n\n        this.#updateFilesAndFolders(response, files, folders)\n      } catch (error) {\n        this.handleError(error)\n      } finally {\n        this.isHandlingScroll = false\n      }\n    }\n  }\n\n  async listAllFiles (path, files = null) {\n    files = files || [] // eslint-disable-line no-param-reassign\n    const res = await this.provider.list(path)\n    res.items.forEach((item) => {\n      if (!item.isFolder) {\n        files.push(item)\n      } else {\n        this.addFolder(item)\n      }\n    })\n    const moreFiles = res.nextPagePath\n    if (moreFiles) {\n      return this.listAllFiles(moreFiles, files)\n    }\n    return files\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => {\n      if (file.isFolder) {\n        return this.addFolder(file)\n      }\n      return this.addFile(file)\n    })\n\n    this.sharedHandler.loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n    }, () => {})\n  }\n\n  render (state, viewOptions = {}) {\n    const { authenticated, didFirstRender } = this.plugin.getPluginState()\n\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const { files, folders, filterInput, loading, currentSelection } = this.plugin.getPluginState()\n    const { isChecked, toggleCheckbox, recordShiftKeyPress, filterItems } = this.sharedHandler\n    const hasInput = filterInput !== ''\n    const headerProps = {\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      getFolder: this.getFolder,\n      directories: this.plugin.getPluginState().directories,\n      pluginIcon: this.plugin.icon,\n      title: this.plugin.title,\n      logout: this.logout,\n      username: this.username,\n      i18n: this.plugin.uppy.i18n,\n    }\n\n    const browserProps = {\n      isChecked,\n      toggleCheckbox,\n      recordShiftKeyPress,\n      currentSelection,\n      files: hasInput ? filterItems(files) : files,\n      folders: hasInput ? filterItems(folders) : folders,\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      filterItems: this.sharedHandler.filterItems,\n      filterQuery: this.filterQuery,\n      logout: this.logout,\n      handleScroll: this.handleScroll,\n      listAllFiles: this.listAllFiles,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header(headerProps),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    if (loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} />\n        </CloseWrapper>\n      )\n    }\n\n    if (!authenticated) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <AuthView\n            pluginName={this.plugin.title}\n            pluginIcon={this.plugin.icon}\n            handleAuth={this.handleAuth}\n            i18n={this.plugin.uppy.i18n}\n            i18nArray={this.plugin.uppy.i18nArray}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"]}