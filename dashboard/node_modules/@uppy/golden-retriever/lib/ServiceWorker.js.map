{"version":3,"sources":["ServiceWorker.js"],"names":["fileCache","Object","create","getCache","name","self","addEventListener","event","waitUntil","Promise","resolve","then","skipWaiting","clients","claim","sendMessageToAllClients","msg","matchAll","forEach","client","postMessage","addFile","store","file","id","data","removeFile","fileID","getFiles","type","files","Error"],"mappings":";;AAAA;AAEA,MAAMA,SAAS,GAAGC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAlB;;AAEA,SAASC,QAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAI,CAACJ,SAAS,CAACI,IAAD,CAAd,EAAsB;AACpBJ,IAAAA,SAAS,CAACI,IAAD,CAAT,GAAkBH,MAAM,CAACC,MAAP,CAAc,IAAd,CAAlB;AACD;;AACD,SAAOF,SAAS,CAACI,IAAD,CAAhB;AACD;;AAEDC,IAAI,CAACC,gBAAL,CAAsB,SAAtB,EAAkCC,KAAD,IAAW;AAC1CA,EAAAA,KAAK,CAACC,SAAN,CAAgBC,OAAO,CAACC,OAAR,GACbC,IADa,CACR,MAAMN,IAAI,CAACO,WAAL,EADE,CAAhB;AAED,CAHD;AAKAP,IAAI,CAACC,gBAAL,CAAsB,UAAtB,EAAmCC,KAAD,IAAW;AAC3CA,EAAAA,KAAK,CAACC,SAAN,CAAgBH,IAAI,CAACQ,OAAL,CAAaC,KAAb,EAAhB;AACD,CAFD;;AAIA,SAASC,uBAAT,CAAkCC,GAAlC,EAAuC;AACrCH,EAAAA,OAAO,CAACI,QAAR,GAAmBN,IAAnB,CAAyBE,OAAD,IAAa;AACnCA,IAAAA,OAAO,CAACK,OAAR,CAAiBC,MAAD,IAAY;AAC1BA,MAAAA,MAAM,CAACC,WAAP,CAAmBJ,GAAnB;AACD,KAFD;AAGD,GAJD;AAKD;;AAED,SAASK,OAAT,CAAkBC,KAAlB,EAAyBC,IAAzB,EAA+B;AAC7BpB,EAAAA,QAAQ,CAACmB,KAAD,CAAR,CAAgBC,IAAI,CAACC,EAArB,IAA2BD,IAAI,CAACE,IAAhC;AACD;;AAED,SAASC,UAAT,CAAqBJ,KAArB,EAA4BK,MAA5B,EAAoC;AAClC,SAAOxB,QAAQ,CAACmB,KAAD,CAAR,CAAgBK,MAAhB,CAAP;AACD;;AAED,SAASC,QAAT,CAAmBN,KAAnB,EAA0B;AACxBP,EAAAA,uBAAuB,CAAC;AACtBc,IAAAA,IAAI,EAAE,gBADgB;AAEtBP,IAAAA,KAFsB;AAGtBQ,IAAAA,KAAK,EAAE3B,QAAQ,CAACmB,KAAD;AAHO,GAAD,CAAvB;AAKD;;AAEDjB,IAAI,CAACC,gBAAL,CAAsB,SAAtB,EAAkCC,KAAD,IAAW;AAAA;;AAC1C,UAAQA,KAAK,CAACkB,IAAN,CAAWI,IAAnB;AACE,SAAK,eAAL;AACER,MAAAA,OAAO,CAACd,KAAK,CAACkB,IAAN,CAAWH,KAAZ,EAAmBf,KAAK,CAACkB,IAAN,CAAWF,IAA9B,CAAP;AACA;;AACF,SAAK,kBAAL;AACEG,MAAAA,UAAU,CAACnB,KAAK,CAACkB,IAAN,CAAWH,KAAZ,EAAmBf,KAAK,CAACkB,IAAN,CAAWE,MAA9B,CAAV;AACA;;AACF,SAAK,gBAAL;AACEC,MAAAA,QAAQ,CAACrB,KAAK,CAACkB,IAAN,CAAWH,KAAZ,CAAR;AACA;;AACF;AACE,YAAM,IAAIS,KAAJ,CAAW,qDAAoDxB,KAArD,mCAAqDA,KAAK,CAAEkB,IAA5D,qBAAqD,YAAaI,IAAK,EAAjF,CAAN;AAXJ;AAaD,CAdD","sourcesContent":["/* globals clients */\n\nconst fileCache = Object.create(null)\n\nfunction getCache (name) {\n  if (!fileCache[name]) {\n    fileCache[name] = Object.create(null)\n  }\n  return fileCache[name]\n}\n\nself.addEventListener('install', (event) => {\n  event.waitUntil(Promise.resolve()\n    .then(() => self.skipWaiting()))\n})\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(self.clients.claim())\n})\n\nfunction sendMessageToAllClients (msg) {\n  clients.matchAll().then((clients) => {\n    clients.forEach((client) => {\n      client.postMessage(msg)\n    })\n  })\n}\n\nfunction addFile (store, file) {\n  getCache(store)[file.id] = file.data\n}\n\nfunction removeFile (store, fileID) {\n  delete getCache(store)[fileID]\n}\n\nfunction getFiles (store) {\n  sendMessageToAllClients({\n    type: 'uppy/ALL_FILES',\n    store,\n    files: getCache(store),\n  })\n}\n\nself.addEventListener('message', (event) => {\n  switch (event.data.type) {\n    case 'uppy/ADD_FILE':\n      addFile(event.data.store, event.data.file)\n      break\n    case 'uppy/REMOVE_FILE':\n      removeFile(event.data.store, event.data.fileID)\n      break\n    case 'uppy/GET_FILES':\n      getFiles(event.data.store)\n      break\n    default:\n      throw new Error(`[ServiceWorker] Unsupported event.data.type. Got: ${event?.data?.type}`)\n  }\n})\n"]}