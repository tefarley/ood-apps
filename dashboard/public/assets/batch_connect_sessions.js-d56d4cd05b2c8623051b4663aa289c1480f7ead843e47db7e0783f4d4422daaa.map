{
  "version": 3,
  "sources": ["../../javascript/packs/batch_connect_sessions.js"],
  "sourcesContent": ["'use strict';\n\nconst pollers = [];\n\nclass Timer {\n  constructor(callback, delay){\n    this.delay = delay;\n    this.remaining = delay;\n    this.active = true;\n    this.callback = callback;\n\n    this.resume();\n  }\n\n  resume() {\n    if(!this.active) { return; }\n\n    this.start = new Date();\n    this.clearTO();\n    this.timerId = setTimeout(this.callback, this.remaining);\n  }\n\n  restart() {\n    if(!this.active) { return; }\n\n    this.remaining = this.delay;\n    resume();\n  }\n\n  pause() {\n    if(!this.active) { return; }\n\n    this.clearTO();\n    this.remaining -= new Date() - this.start;\n  }\n\n  stop(){\n    if(!this.active) { return; }\n    this.clearTO();\n    this.active = false;\n  }\n\n  clearTO(){\n    if(this.timerId !== undefined) {\n      clearTimeout(this.timerId);\n    }\n  }\n\n}\n\nclass Poller {\n  constructor(url, delay) {\n    this.url = url;\n    this.delay = delay;\n    this.poll();\n  }\n\n  poll(){\n    this.timer = new Timer(this.request.bind(this), this.delay);\n  }\n\n  pause() {\n    this.timer.pause();\n  }\n\n  resume() {\n    this.timer.resume();\n  }\n\n  request(){\n    const that = this;\n    $.getScript(this.url)\n        .done((_script, _textStatus, _jqxhr) => {\n          return;\n        }).fail((_jqxhr, textStatus, errorThrown) => {\n      if(textStatus) { console.log(`Failed to get session data. Server returned '${textStatus}'`); }\n      if(errorThrown) {\n        console.log(\"Failed to get session data because of error.\");\n        console.log(errorThrown);\n      }\n      return;\n    }).always(() => {\n      that.poll();\n      return;\n    });\n  }\n}\n\nfunction makePollers(){\n  const obj = $('#batch_connect_sessions');\n  if(!obj) return;\n\n  const url = obj.data('url');\n  const delay = obj.data('delay');\n  if(url && delay) { pollers.push(new Poller(url, delay)); }\n\n  $(document)\n      .on('show.bs.modal', () => {\n        pollers.forEach((poller) => {\n          poller.pause();\n        });\n      }).on('hidden.bs.modal', () => {\n    pollers.forEach((poller) => {\n      poller.resume();\n    });\n  });\n}\n\nfunction settingKey(id) {\n  return id + '_value';\n}\n\nfunction storeSetting(event) {\n  var key = settingKey(event.currentTarget.id);\n  var value = event.currentTarget.value;\n\n  localStorage.setItem(key, value);\n}\n\nfunction tryUpdateSetting(name) {\n  var saved_value = localStorage.getItem(settingKey(name));\n\n  if(saved_value) {\n    var selector = 'input[type=\"range\"][name=\"' + name + '\"]';\n    $(selector).val(saved_value);\n  }\n}\n\nfunction installSettingHandlers(name) {\n  var selector = 'input[type=\"range\"][name=\"' + name + '\"]';\n  $(selector).on('change', function(event){\n    storeSetting(event);\n  });\n}\n\nwindow.installSettingHandlers = installSettingHandlers;\nwindow.tryUpdateSetting = tryUpdateSetting;\n\njQuery(function (){\n  function showSpinner() {\n    $('body').addClass('modal-open');\n    $('#full-page-spinner').removeClass('d-none');\n  }\n\n  makePollers();\n\n  $('button.relaunch').each((index, element) => {\n    $(element).on('click', showSpinner);\n  });\n});\n"],
  "mappings": "AAEA,IAAMA,EAAU,CAAC,EAEXC,EAAN,KAAY,CACV,YAAYC,EAAUC,EAAM,CAC1B,KAAK,MAAQA,EACb,KAAK,UAAYA,EACjB,KAAK,OAAS,GACd,KAAK,SAAWD,EAEhB,KAAK,OAAO,CACd,CAEA,QAAS,CACJ,CAAC,KAAK,SAET,KAAK,MAAQ,IAAI,KACjB,KAAK,QAAQ,EACb,KAAK,QAAU,WAAW,KAAK,SAAU,KAAK,SAAS,EACzD,CAEA,SAAU,CACL,CAAC,KAAK,SAET,KAAK,UAAY,KAAK,MACtB,OAAO,EACT,CAEA,OAAQ,CACH,CAAC,KAAK,SAET,KAAK,QAAQ,EACb,KAAK,WAAa,IAAI,KAAS,KAAK,MACtC,CAEA,MAAM,CACD,CAAC,KAAK,SACT,KAAK,QAAQ,EACb,KAAK,OAAS,GAChB,CAEA,SAAS,CACJ,KAAK,UAAY,QAClB,aAAa,KAAK,OAAO,CAE7B,CAEF,EAEME,EAAN,KAAa,CACX,YAAYC,EAAKF,EAAO,CACtB,KAAK,IAAME,EACX,KAAK,MAAQF,EACb,KAAK,KAAK,CACZ,CAEA,MAAM,CACJ,KAAK,MAAQ,IAAIF,EAAM,KAAK,QAAQ,KAAK,IAAI,EAAG,KAAK,KAAK,CAC5D,CAEA,OAAQ,CACN,KAAK,MAAM,MAAM,CACnB,CAEA,QAAS,CACP,KAAK,MAAM,OAAO,CACpB,CAEA,SAAS,CACP,IAAMK,EAAO,KACb,EAAE,UAAU,KAAK,GAAG,EACf,KAAK,CAACC,EAASC,EAAaC,IAAW,CAExC,CAAC,EAAE,KAAK,CAACA,EAAQC,EAAYC,IAAgB,CAC5CD,GAAc,QAAQ,IAAI,gDAAgDA,IAAa,EACvFC,IACD,QAAQ,IAAI,8CAA8C,EAC1D,QAAQ,IAAIA,CAAW,EAG3B,CAAC,EAAE,OAAO,IAAM,CACdL,EAAK,KAAK,CAEZ,CAAC,CACH,CACF,EAEA,SAASM,GAAa,CACpB,IAAMC,EAAM,EAAE,yBAAyB,EACvC,GAAG,CAACA,EAAK,OAET,IAAMR,EAAMQ,EAAI,KAAK,KAAK,EACpBV,EAAQU,EAAI,KAAK,OAAO,EAC3BR,GAAOF,GAASH,EAAQ,KAAK,IAAII,EAAOC,EAAKF,CAAK,CAAC,EAEtD,EAAE,QAAQ,EACL,GAAG,gBAAiB,IAAM,CACzBH,EAAQ,QAASc,GAAW,CAC1BA,EAAO,MAAM,CACf,CAAC,CACH,CAAC,EAAE,GAAG,kBAAmB,IAAM,CACjCd,EAAQ,QAASc,GAAW,CAC1BA,EAAO,OAAO,CAChB,CAAC,CACH,CAAC,CACH,CAEA,SAASC,EAAWC,EAAI,CACtB,OAAOA,EAAK,QACd,CAEA,SAASC,EAAaC,EAAO,CAC3B,IAAIC,EAAMJ,EAAWG,EAAM,cAAc,EAAE,EACvCE,EAAQF,EAAM,cAAc,MAEhC,aAAa,QAAQC,EAAKC,CAAK,CACjC,CAEA,SAASC,EAAiBC,EAAM,CAC9B,IAAIC,EAAc,aAAa,QAAQR,EAAWO,CAAI,CAAC,EAEvD,GAAGC,EAAa,CACd,IAAIC,EAAW,6BAA+BF,EAAO,KACrD,EAAEE,CAAQ,EAAE,IAAID,CAAW,CAC7B,CACF,CAEA,SAASE,EAAuBH,EAAM,CACpC,IAAIE,EAAW,6BAA+BF,EAAO,KACrD,EAAEE,CAAQ,EAAE,GAAG,SAAU,SAASN,EAAM,CACtCD,EAAaC,CAAK,CACpB,CAAC,CACH,CAEA,OAAO,uBAAyBO,EAChC,OAAO,iBAAmBJ,EAE1B,OAAO,UAAW,CAChB,SAASK,GAAc,CACrB,EAAE,MAAM,EAAE,SAAS,YAAY,EAC/B,EAAE,oBAAoB,EAAE,YAAY,QAAQ,CAC9C,CAEAd,EAAY,EAEZ,EAAE,iBAAiB,EAAE,KAAK,CAACe,EAAOC,IAAY,CAC5C,EAAEA,CAAO,EAAE,GAAG,QAASF,CAAW,CACpC,CAAC,CACH,CAAC",
  "names": ["pollers", "Timer", "callback", "delay", "Poller", "url", "that", "_script", "_textStatus", "_jqxhr", "textStatus", "errorThrown", "makePollers", "obj", "poller", "settingKey", "id", "storeSetting", "event", "key", "value", "tryUpdateSetting", "name", "saved_value", "selector", "installSettingHandlers", "showSpinner", "index", "element"]
}
