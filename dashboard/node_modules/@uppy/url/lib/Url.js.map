{"version":3,"sources":["Url.jsx"],"names":["toArray","UrlUI","forEachDroppedOrPastedUrl","packageJson","locale","UrlIcon","addProtocolToURL","url","protocolRegex","defaultProtocol","test","canHandleRootDrop","e","items","dataTransfer","urls","filter","item","kind","type","length","checkIfCorrectURL","protocol","match","getFileNameFromUrl","pathname","URL","substring","lastIndexOf","Url","UIPlugin","constructor","uppy","opts","id","title","icon","defaultLocale","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","RequestClient","companionHeaders","companionCookiesRule","post","then","res","error","log","protocollessUrl","optionalMeta","undefined","info","i18n","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","providerOptions","err","isRestriction","message","details","clipboardData","render","install","target","mount","uninstall","unmount","VERSION","version","prototype"],"mappings":";;AAAA;;AACA;;AACA;;MACOA,O;;MACAC,K;;MACAC,yB;;MAEAC,W;;;;MACAC,M;;AAEP,SAASC,OAAT,GAAoB;AAClB,SACE;AAAK,mBAAY,MAAjB;AAAwB,IAAA,SAAS,EAAC,OAAlC;AAA0C,IAAA,KAAK,EAAC,IAAhD;AAAqD,IAAA,MAAM,EAAC,IAA5D;AAAiE,IAAA,OAAO,EAAC;AAAzE,KACE;AAAG,IAAA,IAAI,EAAC,MAAR;AAAe,IAAA,QAAQ,EAAC;AAAxB,KACE;AAAM,IAAA,SAAS,EAAC,qBAAhB;AAAsC,IAAA,IAAI,EAAC,SAA3C;AAAqD,IAAA,KAAK,EAAC,IAA3D;AAAgE,IAAA,MAAM,EAAC,IAAvE;AAA4E,IAAA,EAAE,EAAC;AAA/E,IADF,EAEE;AAAM,IAAA,CAAC,EAAC,82BAAR;AAAu3B,IAAA,IAAI,EAAC,MAA53B;AAAm4B,IAAA,QAAQ,EAAC;AAA54B,IAFF,CADF,CADF;AAQD;;AAED,SAASC,gBAAT,CAA2BC,GAA3B,EAAgC;AAC9B,QAAMC,aAAa,GAAG,iBAAtB;AACA,QAAMC,eAAe,GAAG,SAAxB;;AACA,MAAID,aAAa,CAACE,IAAd,CAAmBH,GAAnB,CAAJ,EAA6B;AAC3B,WAAOA,GAAP;AACD;;AAED,SAAOE,eAAe,GAAGF,GAAzB;AACD;;AAED,SAASI,iBAAT,CAA4BC,CAA5B,EAA+B;AAC7B,QAAMC,KAAK,GAAGb,OAAO,CAACY,CAAC,CAACE,YAAF,CAAeD,KAAhB,CAArB;AACA,QAAME,IAAI,GAAGF,KAAK,CAACG,MAAN,CAAcC,IAAD,IAAUA,IAAI,CAACC,IAAL,KAAc,QAAd,IAC/BD,IAAI,CAACE,IAAL,KAAc,eADN,CAAb;AAEA,SAAOJ,IAAI,CAACK,MAAL,GAAc,CAArB;AACD;;AAED,SAASC,iBAAT,CAA4Bd,GAA5B,EAAiC;AAC/B,MAAI,CAACA,GAAL,EAAU,OAAO,KAAP;AAEV,QAAMe,QAAQ,GAAGf,GAAG,CAACgB,KAAJ,CAAU,mBAAV,EAA+B,CAA/B,CAAjB;;AACA,MAAID,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,OAAxC,EAAiD;AAC/C,WAAO,KAAP;AACD;;AAED,SAAO,IAAP;AACD;;AAED,SAASE,kBAAT,CAA6BjB,GAA7B,EAAkC;AAChC,QAAM;AAAEkB,IAAAA;AAAF,MAAe,IAAIC,GAAJ,CAAQnB,GAAR,CAArB;AACA,SAAOkB,QAAQ,CAACE,SAAT,CAAmBF,QAAQ,CAACG,WAAT,CAAqB,GAArB,IAA4B,CAA/C,CAAP;AACD;AACD;AACA;AACA;AACA;;;AACe,MAAMC,GAAN,SAAkBC,cAAlB,CAA2B;AAGxCC,EAAAA,WAAW,CAAEC,IAAF,EAAQC,IAAR,EAAc;AACvB,UAAMD,IAAN,EAAYC,IAAZ;AACA,SAAKC,EAAL,GAAU,KAAKD,IAAL,CAAUC,EAAV,IAAgB,KAA1B;AACA,SAAKC,KAAL,GAAa,KAAKF,IAAL,CAAUE,KAAV,IAAmB,MAAhC;AACA,SAAKhB,IAAL,GAAY,UAAZ;;AACA,SAAKiB,IAAL,GAAY,MAAM,eAAC,OAAD,OAAlB,CALuB,CAOvB;;;AACA,SAAKC,aAAL,GAAqBjC,MAArB;AAEA,UAAMkC,cAAc,GAAG,EAAvB;AAEA,SAAKL,IAAL,GAAY,EAAE,GAAGK,cAAL;AAAqB,SAAGL;AAAxB,KAAZ;AAEA,SAAKM,QAAL;AAEA,SAAKC,QAAL,GAAgB,KAAKP,IAAL,CAAUQ,YAA1B;;AAEA,QAAI,CAAC,KAAKD,QAAV,EAAoB;AAClB,YAAM,IAAIE,KAAJ,CAAU,+EAAV,CAAN;AACD,KApBsB,CAsBvB;;;AACA,SAAKC,OAAL,GAAe,KAAKA,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKC,OAAL,GAAe,KAAKA,OAAL,CAAaD,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKE,cAAL,GAAsB,KAAKA,cAAL,CAAoBF,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKG,eAAL,GAAuB,KAAKA,eAAL,CAAqBH,IAArB,CAA0B,IAA1B,CAAvB;AAEA,SAAKI,MAAL,GAAc,IAAIC,8BAAJ,CAAkBjB,IAAlB,EAAwB;AACpCS,MAAAA,YAAY,EAAE,KAAKR,IAAL,CAAUQ,YADY;AAEpCS,MAAAA,gBAAgB,EAAE,KAAKjB,IAAL,CAAUiB,gBAFQ;AAGpCC,MAAAA,oBAAoB,EAAE,KAAKlB,IAAL,CAAUkB;AAHI,KAAxB,CAAd;AAKD;;AAEDR,EAAAA,OAAO,CAAEpC,GAAF,EAAO;AACZ,WAAO,KAAKyC,MAAL,CAAYI,IAAZ,CAAiB,UAAjB,EAA6B;AAAE7C,MAAAA;AAAF,KAA7B,EACJ8C,IADI,CACEC,GAAD,IAAS;AACb,UAAIA,GAAG,CAACC,KAAR,EAAe;AACb,aAAKvB,IAAL,CAAUwB,GAAV,CAAc,cAAd;AACA,aAAKxB,IAAL,CAAUwB,GAAV,CAAcF,GAAG,CAACC,KAAlB;AACA,cAAM,IAAIb,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACD,aAAOY,GAAP;AACD,KARI,CAAP;AASD;;AAEY,QAAPT,OAAO,CAAEY,eAAF,EAAmBC,YAAnB,EAA6C;AAAA,QAA1BA,YAA0B;AAA1BA,MAAAA,YAA0B,GAAXC,SAAW;AAAA;;AACxD,UAAMpD,GAAG,GAAG,KAAKD,gBAAL,CAAsBmD,eAAtB,CAAZ;;AACA,QAAI,CAAC,KAAKpC,iBAAL,CAAuBd,GAAvB,CAAL,EAAkC;AAChC,WAAKyB,IAAL,CAAUwB,GAAV,CAAe,gCAA+BjD,GAAI,EAAlD;AACA,WAAKyB,IAAL,CAAU4B,IAAV,CAAe,KAAKC,IAAL,CAAU,iBAAV,CAAf,EAA6C,OAA7C,EAAsD,IAAtD;AACA,aAAOF,SAAP;AACD;;AAED,QAAI;AACF,YAAMG,IAAI,GAAG,MAAM,KAAKnB,OAAL,CAAapC,GAAb,CAAnB;AAEA,YAAMwD,OAAO,GAAG;AACdD,QAAAA,IAAI,EAAEJ,YADQ;AAEdM,QAAAA,MAAM,EAAE,KAAK9B,EAFC;AAGd+B,QAAAA,IAAI,EAAE,KAAKzC,kBAAL,CAAwBjB,GAAxB,CAHQ;AAIdY,QAAAA,IAAI,EAAE2C,IAAI,CAAC3C,IAJG;AAKd+C,QAAAA,IAAI,EAAE;AACJC,UAAAA,IAAI,EAAEL,IAAI,CAACK;AADP,SALQ;AAQdC,QAAAA,QAAQ,EAAE,IARI;AASdC,QAAAA,IAAI,EAAE;AACJ9D,UAAAA;AADI,SATQ;AAYd+D,QAAAA,MAAM,EAAE;AACN7B,UAAAA,YAAY,EAAE,KAAKR,IAAL,CAAUQ,YADlB;AAENlC,UAAAA,GAAG,EAAG,GAAE,KAAKiC,QAAS,UAFhB;AAGN6B,UAAAA,IAAI,EAAE;AACJE,YAAAA,MAAM,EAAEhE,GADJ;AAEJA,YAAAA;AAFI,WAHA;AAONiE,UAAAA,eAAe,EAAE,KAAKxB,MAAL,CAAYf;AAPvB;AAZM,OAAhB;AAsBA,WAAKD,IAAL,CAAUwB,GAAV,CAAc,0BAAd;;AACA,UAAI;AACF,eAAO,KAAKxB,IAAL,CAAUa,OAAV,CAAkBkB,OAAlB,CAAP;AACD,OAFD,CAEE,OAAOU,GAAP,EAAY;AACZ,YAAI,CAACA,GAAG,CAACC,aAAT,EAAwB;AACtB,eAAK1C,IAAL,CAAUwB,GAAV,CAAciB,GAAd;AACD;;AACD,eAAOA,GAAP;AACD;AACF,KAlCD,CAkCE,OAAOA,GAAP,EAAY;AACZ,WAAKzC,IAAL,CAAUwB,GAAV,CAAciB,GAAd;AACA,WAAKzC,IAAL,CAAU4B,IAAV,CAAe;AACbe,QAAAA,OAAO,EAAE,KAAKd,IAAL,CAAU,eAAV,CADI;AAEbe,QAAAA,OAAO,EAAEH;AAFI,OAAf,EAGG,OAHH,EAGY,IAHZ;AAIA,aAAOA,GAAP;AACD;AACF;;AAED3B,EAAAA,cAAc,CAAElC,CAAF,EAAK;AACjBV,IAAAA,yBAAyB,CAACU,CAAC,CAACE,YAAH,EAAiB,MAAjB,EAA0BP,GAAD,IAAS;AACzD,WAAKyB,IAAL,CAAUwB,GAAV,CAAe,uCAAsCjD,GAAI,EAAzD;AACA,WAAKsC,OAAL,CAAatC,GAAb;AACD,KAHwB,CAAzB;AAID;;AAEDwC,EAAAA,eAAe,CAAEnC,CAAF,EAAK;AAClBV,IAAAA,yBAAyB,CAACU,CAAC,CAACiE,aAAH,EAAkB,OAAlB,EAA4BtE,GAAD,IAAS;AAC3D,WAAKyB,IAAL,CAAUwB,GAAV,CAAe,sCAAqCjD,GAAI,EAAxD;AACA,WAAKsC,OAAL,CAAatC,GAAb;AACD,KAHwB,CAAzB;AAID;;AAEDuE,EAAAA,MAAM,GAAI;AACR,WAAO,eAAC,KAAD;AAAO,MAAA,IAAI,EAAE,KAAKjB,IAAlB;AAAwB,MAAA,OAAO,EAAE,KAAKhB;AAAtC,MAAP;AACD;;AAEDkC,EAAAA,OAAO,GAAI;AACT,UAAM;AAAEC,MAAAA;AAAF,QAAa,KAAK/C,IAAxB;;AACA,QAAI+C,MAAJ,EAAY;AACV,WAAKC,KAAL,CAAWD,MAAX,EAAmB,IAAnB;AACD;AACF;;AAEDE,EAAAA,SAAS,GAAI;AACX,SAAKC,OAAL;AACD;;AAjIuC;;AAArBtD,G,CACZuD,O,GAAUjF,WAAW,CAACkF,O;iBADVxD,G,EAoIrB;;AACAA,GAAG,CAACyD,SAAJ,CAAchF,gBAAd,GAAiCA,gBAAjC;AACAuB,GAAG,CAACyD,SAAJ,CAAc3E,iBAAd,GAAkCA,iBAAlC;AACAkB,GAAG,CAACyD,SAAJ,CAAcjE,iBAAd,GAAkCA,iBAAlC;AACAQ,GAAG,CAACyD,SAAJ,CAAc9D,kBAAd,GAAmCA,kBAAnC","sourcesContent":["import { h } from 'preact'\nimport { UIPlugin } from '@uppy/core'\nimport { RequestClient } from '@uppy/companion-client'\nimport toArray from '@uppy/utils/lib/toArray'\nimport UrlUI from './UrlUI.jsx'\nimport forEachDroppedOrPastedUrl from './utils/forEachDroppedOrPastedUrl.js'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nfunction UrlIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <rect className=\"uppy-ProviderIconBg\" fill=\"#FF753E\" width=\"32\" height=\"32\" rx=\"16\" />\n        <path d=\"M22.788 15.389l-2.199 2.19a3.184 3.184 0 0 1-.513.437c-.806.584-1.686.876-2.638.876a4.378 4.378 0 0 1-3.519-1.752c-.22-.292-.146-.802.147-1.021.293-.22.806-.146 1.026.146.953 1.313 2.785 1.532 4.105.583a.571.571 0 0 0 .293-.292l2.199-2.189c1.1-1.167 1.1-2.992-.073-4.086a2.976 2.976 0 0 0-4.105 0l-1.246 1.24a.71.71 0 0 1-1.026 0 .703.703 0 0 1 0-1.022l1.246-1.24a4.305 4.305 0 0 1 6.083 0c1.833 1.605 1.906 4.451.22 6.13zm-7.183 5.035l-1.246 1.24a2.976 2.976 0 0 1-4.105 0c-1.172-1.094-1.172-2.991-.073-4.086l2.2-2.19.292-.291c.66-.438 1.393-.657 2.2-.584.805.146 1.465.51 1.905 1.168.22.292.733.365 1.026.146.293-.22.367-.73.147-1.022-.733-.949-1.76-1.532-2.859-1.678-1.1-.22-2.272.073-3.225.802l-.44.438-2.199 2.19c-1.686 1.75-1.612 4.524.074 6.202.88.803 1.979 1.241 3.078 1.241 1.1 0 2.199-.438 3.079-1.24l1.246-1.241a.703.703 0 0 0 0-1.022c-.294-.292-.807-.365-1.1-.073z\" fill=\"#FFF\" fillRule=\"nonzero\" />\n      </g>\n    </svg>\n  )\n}\n\nfunction addProtocolToURL (url) {\n  const protocolRegex = /^[a-z0-9]+:\\/\\//\n  const defaultProtocol = 'http://'\n  if (protocolRegex.test(url)) {\n    return url\n  }\n\n  return defaultProtocol + url\n}\n\nfunction canHandleRootDrop (e) {\n  const items = toArray(e.dataTransfer.items)\n  const urls = items.filter((item) => item.kind === 'string'\n    && item.type === 'text/uri-list')\n  return urls.length > 0\n}\n\nfunction checkIfCorrectURL (url) {\n  if (!url) return false\n\n  const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n  if (protocol !== 'http' && protocol !== 'https') {\n    return false\n  }\n\n  return true\n}\n\nfunction getFileNameFromUrl (url) {\n  const { pathname } = new URL(url)\n  return pathname.substring(pathname.lastIndexOf('/') + 1)\n}\n/**\n * Url\n *\n */\nexport default class Url extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = this.opts.title || 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = locale\n\n    const defaultOptions = {}\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleRootDrop = this.handleRootDrop.bind(this)\n    this.handleRootPaste = this.handleRootPaste.bind(this)\n\n    this.client = new RequestClient(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n  }\n\n  getMeta (url) {\n    return this.client.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  async addFile (protocollessUrl, optionalMeta = undefined) {\n    const url = this.addProtocolToURL(protocollessUrl)\n    if (!this.checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return undefined\n    }\n\n    try {\n      const meta = await this.getMeta(url)\n\n      const tagFile = {\n        meta: optionalMeta,\n        source: this.id,\n        name: this.getFileNameFromUrl(url),\n        type: meta.type,\n        data: {\n          size: meta.size,\n        },\n        isRemote: true,\n        body: {\n          url,\n        },\n        remote: {\n          companionUrl: this.opts.companionUrl,\n          url: `${this.hostname}/url/get`,\n          body: {\n            fileId: url,\n            url,\n          },\n          providerOptions: this.client.opts,\n        },\n      }\n      this.uppy.log('[Url] Adding remote file')\n      try {\n        return this.uppy.addFile(tagFile)\n      } catch (err) {\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n        return err\n      }\n    } catch (err) {\n      this.uppy.log(err)\n      this.uppy.info({\n        message: this.i18n('failedToFetch'),\n        details: err,\n      }, 'error', 4000)\n      return err\n    }\n  }\n\n  handleRootDrop (e) {\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  handleRootPaste (e) {\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render () {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install () {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n\n// TODO: remove from prototype in the next major.\nUrl.prototype.addProtocolToURL = addProtocolToURL\nUrl.prototype.canHandleRootDrop = canHandleRootDrop\nUrl.prototype.checkIfCorrectURL = checkIfCorrectURL\nUrl.prototype.getFileNameFromUrl = getFileNameFromUrl\n"]}